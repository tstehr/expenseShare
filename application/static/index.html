<!doctype html>
<html>
<head>
	<meta charset="utf-8">

	<title>expenseShare</title>
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0">

	<link rel="stylesheet" href="/css/icons-embedded.css">
	<link rel="stylesheet" href="/css/style.css">
</head>
<body>


<div id="app">
	<div class="gridBox mainView"></diV>
	<div class="gridBox sideView"></diV>
	<div class="gridBox personView"></div>
	<div class="gridBox transferView">
		<section class="module">
			<header class="module-header"><h1>Transfers</h1></header>
			<div class="module-body"></div>
		</section>
	</div>
</div>

<!-- Templates start here -->

<script type="text/template" id="module-template">
	<header class="module-header"><h1><%= title %></h1></header>
	<div class="module-body"></div>
</script>

<script type="text/template" id="month-template">
	<header class="module-header"></header>

	<h2 class="visuallyhidden">Expenses</h2>
	<div class="scroll-wrapper">
		<section class="module-body month-expenses">
			<a class="month-new row" href="/<%= id %>/createExpense">
				<span class="visuallyhidden">Add new Expense</span>
				<span class="icon-plus" aria-hidden="true"></span>
			</a>
			<ul class="month-expense-list list expense-list"></ul>
		</section>
	</div>

	<h2 class="visuallyhidden">Transfers</h2>
	<section class="module-body month-transfers"></section>
	

	<div class="module-buttonBar">
		<button class="month-toggle">
			<span class="month-showTransfers">Show Results</span>
			<span class="month-showExpenses">Show Expenses</span>
		</button>
	</div>
</script>


<script type="text/template" id="month-header-template">
	<h1><%= title %></h1>
	<a href="/<%= prevMonth %>">
		<span class="icon-left-open" aria-hidden="true"></span>
		<span class="visuallyhidden">Back</span>
	</a>
	<a href="/<%= nextMonth %>" class="right">
		<span class="visuallyhidden">Next</span>
		<span class="icon-right-open" aria-hidden="true"></span>
	</a>
</script>



<script type="text/template" id="person-template">
	<label class="row"><input type="text" value="<%= name %>"></label>
</script>


<script type="text/template" id="expense-template">
	<a href="/<%= month %>/expense/<%= id %>" class="row emphasize"><%= description %></a>
	<a href="/<%= month %>/expense/<%= id %>" class="row"><%= app.Util.formatCurrency(amount) %>&thinsp;€</a>
</script>


<script type="text/template" id="expense-edit-template">
	<header class="module-header"></header>

	<div class="scroll-wrapper">
		<div class="module-body <%= isNew ? 'hasBar' : '' %>">
			<ul class="list participation-list"></ul>
		</div>
	</div>

	<% if (isNew) { %>
		<div class="module-buttonBar">
			<button class="confirm expense-persistAndClose">
				<span class="visuallyhidden">Save</span>
				<span aria-hidden="true" class="icon-ok"></span>
			</button>
			<button class="confirm expense-persistAndEdit">
				<span class="visuallyhidden">Save</span>
				<span aria-hidden="true" class="icon-ok"></span>
			</button>
			<button class="decline expense-discard">
				<span class="visuallyhidden">Discard</span>
				<span aria-hidden="true" class="icon-cancel"></span>
			</button>
		</div>
	<% } else { %>
		<div class="module-overlay">
			Sure?
			<div class="module-buttonBar">
				<button class="confirm expense-delete">
					<span class="visuallyhidden">Delete</span>
					<span aria-hidden="true" class="icon-ok"></span>
				</button>
				<button class="decline expense-hideDelete">
					<span class="visuallyhidden">Cancel</span>
					<span aria-hidden="true" class="icon-cancel"></span>
				</button>
			</div>
		</div>
	<% } %>
</script>


<script type="text/template" id="expense-edit-header-template">
	<h1><input type="text" value="<%= description %>" class="expense-description" placeholder="Enter description"></h1>

	<% if (!isNew) { %>
		<a href="/<%= month %>" class="expense-back">
			<span class="visuallyhidden">Back to month</span>
			<span aria-hidden="true" class="icon-left-open"></span>
		</a>
		<button class="expense-showDelete right">
			<span class="visuallyhidden">Delete Expense</span>
			<span class="icon-trash" aria-hidden="true"></span>
		</button>
	<% } %>
</script>

<script type="text/template" id="participation-template">
	<label class="row participation-toggle-container">
		<span class="visuallyhidden">Participating: </span>
		<input type="checkbox" <%=participating ? "checked" : ""%> class="participation-toggle" id="participation-toggle-<%= cid %>">
		<span class="icon-ok" aria-hidden="true"></span>
	</label>
	<label class="row emphasize" for="participation-toggle-<%= cid %>"><%= personName %></label>
	<label class="row participation-amount-container">
		<span class="visuallyhidden">Amount: </span>
		<input type="number" value="<%= app.Util.formatCurrency(amount) %>" class="participation-amount">&thinsp;€
	</label>
</script>


<script type="text/template" id="month-transfers-template">
	<p> Total: <%= app.Util.formatCurrency(amount) %>&thinsp;€</p>
	<% Object.keys(transfers).forEach(function (fromCid) { %>
		<% if (transfers[fromCid] && Object.keys(transfers[fromCid]).length > 0) { %> 
			<p>
				<%= app.persons.get(fromCid).get('name') %>: 
				<ul>
				<% Object.keys(transfers[fromCid]).forEach(function (toCid) { %>
					<li>
						<%= app.Util.formatCurrency(transfers[fromCid][toCid]) %>&thinsp;€
						to <%= app.persons.get(toCid).get('name') %>
					</li>
				<% }); %>
				</ul>
			</p>
		<% } %>
	<% }); %>
</script>

<!--
	TODO Look into minification / concatnation of scripts (buildscript!)
	https://github.com/h5bp/node-build-script
-->

<script src="/js/libs/fastclick.js"></script>
<script src="/js/libs/jquery-1.9.1.js"></script>
<script src="/js/libs/underscore.js"></script>
<script src="/js/libs/backbone.js"></script>
<script src="/js/libs/backbone-relational.js"></script>

<script src="/js/util/Util.js"></script>

<script src="/js/models/Month.js"></script>
<script src="/js/models/Expense.js"></script>
<script src="/js/models/Person.js"></script>
<script src="/js/models/Participation.js"></script>

<script src="/js/collections/ExpenseCollection.js"></script>
<script src="/js/collections/PersonCollection.js"></script>
<script src="/js/collections/ParticipationCollection.js"></script>

<script src="/js/views/AView.js"></script>
<script src="/js/views/WrappingModuleView.js"></script>
<script src="/js/views/AppView.js"></script>
<script src="/js/views/MonthView.js"></script>
<script src="/js/views/MonthTransfersView.js"></script>
<script src="/js/views/ExpenseView.js"></script>
<script src="/js/views/ExpenseEditView.js"></script>
<script src="/js/views/PersonView.js"></script>
<script src="/js/views/ParticipationView.js"></script>

<script src="/js/views/ACollectionView.js"></script>
<script src="/js/views/ExpenseCollectionView.js"></script>
<script src="/js/views/PersonCollectionView.js"></script>
<script src="/js/views/ParticipationCollectionView.js"></script>

<script src="/js/routers/AppRouter.js"></script>

<script>
// If you're wondering what the heck we're doing here: 
// http://addyosmani.github.io/backbone-fundamentals


$(function () {
	app.persons = new app.PersonCollection();

	app.appView = new app.AppView({
		el: '#app'
	});
	app.appView.render();

	app.appRouter = new app.AppRouter();
	Backbone.history.start({pushState: true});
			
	app.persons.fetch();
});
</script>

</body>
</html>
